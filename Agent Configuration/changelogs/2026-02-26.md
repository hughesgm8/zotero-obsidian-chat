# Changelog — 2026-02-26

## [12:30] Fix follow-up questions losing paper context
- **File Modified**: `src/orchestrator.ts`
- **Change**: Follow-up questions like "tell me more about that paper" now carry forward sources from the last assistant message, so the LLM retains context about previously discussed papers.
- **Logic Update**:
  ```
  # In query():
  # 1. After extractItemKeys, walk conversationHistory backwards to find
  #    last assistant message with sources → collect keys into carryForwardKeys
  # 2. After fetching metadata for new search results, fetch metadata for
  #    any carryForwardKeys not already in results → append to sources
  # 3. When selecting top N papers for full text, prioritize carry-forward
  #    papers (user is likely asking about them) over new search results
  ```
- **Reason**: Every message triggered a fresh semantic search using the raw follow-up text as the query. Vague follow-ups like "tell me more" make terrible search queries, so zotero-mcp returned completely different papers. Now the previous turn's sources are carried forward and prioritized for full text, so the LLM can answer follow-up questions correctly.

## [~13:00] Smart Import: Import paper from Zotero with AI summary
- **Files Created**: `src/paper-importer.ts`, `src/import-modal.ts`
- **Files Modified**: `src/types.ts`, `src/settings.ts`, `src/main.ts`, `styles.css`
- **Change**: Added a new command-palette feature that lets you search your Zotero library, pick a paper, and auto-generate a fully structured note (Summary, Interesting Takeaways, Critique, Relevance, Abstract) using your configured LLM.
- **Logic Update**:
  ```
  # types.ts — added importFolder + researchDescription settings
  # settings.ts — new "Smart Import" section (folder path, research interests textarea)
  # paper-importer.ts — PaperImporter class:
  #   search(query) → zotero_semantic_search → fetch metadata for each result
  #   importPaper(source) → fetch full text (untruncated) → LLM prompt → parse sections → build note markdown → save to vault
  # import-modal.ts — ImportModal (plain Modal):
  #   search input (400ms debounce) → clickable results (title + authors/year) → select → close modal → import + open note
  # main.ts — register "import-paper-from-zotero" command, getMCPClient() accessor
  # styles.css — import modal styles (search input, scrollable results, hover highlights)
  ```
- **Reason**: Replaces the manual workflow of importing references via Zotero Integration and hand-filling Summary/Takeaways/Critique/Relevance sections. One command, fully populated note.
